apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "hypersdk.fullname" . }}
  labels:
    {{- include "hypersdk.labels" . | nindent 4 }}
data:
  log_level: {{ .Values.config.logLevel | quote }}
  daemon_addr: {{ .Values.config.daemonAddr | quote }}
  download_workers: {{ .Values.config.downloadWorkers | quote }}
  chunk_size: {{ .Values.config.chunkSize | quote }}
  retry_attempts: {{ .Values.config.retryAttempts | quote }}
  retry_delay: {{ .Values.config.retryDelay | quote }}
  
  config.yaml: |
    # HyperSDK Daemon Configuration
    # Generated by Helm

    daemon_addr: {{ .Values.config.daemonAddr | quote }}
    log_level: {{ .Values.config.logLevel | quote }}

    # Download settings
    download_workers: {{ .Values.config.downloadWorkers }}
    chunk_size: {{ .Values.config.chunkSize }}
    retry_attempts: {{ .Values.config.retryAttempts }}
    retry_delay: {{ .Values.config.retryDelay | quote }}

    # Database
    database_path: {{ .Values.config.databasePath | quote }}

    # Job scheduling
    scheduler:
      enabled: {{ .Values.config.scheduler.enabled }}
      timezone: {{ .Values.config.scheduler.timezone | quote }}
      max_concurrent_jobs: {{ .Values.config.scheduler.maxConcurrentJobs }}

    # Webhooks
    webhooks: {{ .Values.config.webhooks | toJson }}

    # Metrics
    metrics:
      enabled: true
      addr: {{ .Values.config.metricsAddr | quote }}
      path: "/metrics"

    # Rate limiting
    rate_limiting:
      enabled: {{ .Values.config.rateLimiting.enabled }}
      requests_per_minute: {{ .Values.config.rateLimiting.requestsPerMinute }}
      burst: {{ .Values.config.rateLimiting.burst }}

    # Security
    security:
      enable_tls: {{ .Values.config.security.enableTLS }}

    # Audit logging
    audit:
      enabled: {{ .Values.config.audit.enabled }}
      log_path: {{ .Values.config.audit.logPath | quote }}
      max_size: {{ .Values.config.audit.maxSize }}
      max_backups: {{ .Values.config.audit.maxBackups }}
      max_age: {{ .Values.config.audit.maxAge }}
